[{"sha":"ff96e8f9963735fb60dd640ecd3de9035c85c9c4","node_id":"C_kwDOA8vtDtoAKGZmOTZlOGY5OTYzNzM1ZmI2MGRkNjQwZWNkM2RlOTAzNWM4NWM5YzQ","commit":{"author":{"name":"Cristian Măgherușan-Stanciu","email":"cristim@users.noreply.github.com","date":"2021-10-14T10:08:47Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2021-10-14T10:08:47Z"},"message":"Feat/ec2 fleet integration (#471)\n\n* Carve instanceManager from instances.go into instance_manager.go\r\n\r\n* Move instanceManager tests to instance_manager_test.go\r\n\r\n* Move read-only instance query functions to instance_queries.go\r\n\r\n* Move additional code to instance_queries.go and instance_queries_test.go\r\n\r\n* Move OD->Spot conversion helpers to instance_conversion.go and instance_actions.go\r\n\r\n* Fix linter issues in autoscaling_test.go\r\n\r\n* Fix linter issues in mock_test.go\r\n\r\n* Fix linter issues in region.go and spot_price.go\r\n\r\n* Convert RunInstances to instant EC2 Fleet API call\r\n\r\n- This allows us to implement support for allocation strategies, currently hardcoded\r\n  to capacity-optimized-prioritized, but later it could be made configurable.\r\n- It requires the use of a temporary LaunchTemplate, which is created based\r\n  on the data previously passed to the RunInstances API call and deleted immediately\r\n  after the EC2 fleet API call.\r\n\r\n* Convert tests for createRunInstancesInput to createLaunchTemplateData\r\n\r\n* Small log message fix\r\n\r\n* Add additional EC2 mocks\r\n\r\n* Implement support for configurable Spot allocation strategies\r\n\r\n- Added global config with per-ASG tag overrides\r\n- Extended unit test coverage for the new logic\r\n- Improved tests for reading other configurations from tags\r\n- Added unit tests for EBS block device conversion logic\r\n- Converted PatchBeanstalkUserdata config flag to bool value\r\n\r\n* Move small utility functions to util.go\r\n\r\n* Fix codeclimate issue\r\n\r\n* Extract complex if condition into its own function, pass instance type information by reference\r\n\r\n* Further simplifications for codeclimate\r\n\r\n* Use latest version of golang and build for amd64\r\n\r\n* Expose spot_allocation_strategy on CloudFormation\r\n\r\n* Ensure the AMI ID comes from the LaunchConfiguration/Template\r\n\r\n* Add required IAM permissions\r\n\r\n* Set priority for capacity-optimized-prioritized\r\n\r\n* Pass missing LaunchTemplate fields, such as UserData and KeyName\r\n\r\n* Expand test coverage\r\n\r\n* Document the capacity-optimized prioritized\r\n\r\n* Small readme changes","tree":{"sha":"8ce1c36d2d6f2dae9e03cc0ed0392c797beb107f","url":"https://api.github.com/repos/cloudutil/AutoSpotting/git/trees/8ce1c36d2d6f2dae9e03cc0ed0392c797beb107f"},"url":"https://api.github.com/repos/cloudutil/AutoSpotting/git/commits/ff96e8f9963735fb60dd640ecd3de9035c85c9c4","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhaAGvCRBK7hj4Ov3rIwAAbjIIACLPMvTfCXHHNbH3XgCzxjo1\nXiYjKj4x8fR6IBgDJeb976dw6h2LcY3OF6DeQMji7fvoNUKxxzd3fDVWfOkaVyAv\nPY7dAB57s/sS0nR1gDCbaTzeLtCDCzxCXlSGGlcf1kSzqmcQMK++5/i8i+vuQMNh\nzvId0EPycXqtpzRFD34yBxhAST9vNSG6Ahwl1S6XBdX3Q+OqJkyjnrxKclB9opuF\nArFRjN6OJK+1aJ3m+MMMu2zZWiEUFJNI1ylK21glfHv1FPB6tmE1HosVeq2znCXS\n/0y80OfuWhXxXRNfXP9HLDhI1NLsKgmCLSiDc+ii0R1OSeeFoCp3AUIcHJgw/IE=\n=s/+K\n-----END PGP SIGNATURE-----\n","payload":"tree 8ce1c36d2d6f2dae9e03cc0ed0392c797beb107f\nparent 751b4cc1b0cdd5f6523f2828d92f31c3c5e223f2\nauthor Cristian Măgherușan-Stanciu <cristim@users.noreply.github.com> 1634206127 +0200\ncommitter GitHub <noreply@github.com> 1634206127 +0200\n\nFeat/ec2 fleet integration (#471)\n\n* Carve instanceManager from instances.go into instance_manager.go\r\n\r\n* Move instanceManager tests to instance_manager_test.go\r\n\r\n* Move read-only instance query functions to instance_queries.go\r\n\r\n* Move additional code to instance_queries.go and instance_queries_test.go\r\n\r\n* Move OD->Spot conversion helpers to instance_conversion.go and instance_actions.go\r\n\r\n* Fix linter issues in autoscaling_test.go\r\n\r\n* Fix linter issues in mock_test.go\r\n\r\n* Fix linter issues in region.go and spot_price.go\r\n\r\n* Convert RunInstances to instant EC2 Fleet API call\r\n\r\n- This allows us to implement support for allocation strategies, currently hardcoded\r\n  to capacity-optimized-prioritized, but later it could be made configurable.\r\n- It requires the use of a temporary LaunchTemplate, which is created based\r\n  on the data previously passed to the RunInstances API call and deleted immediately\r\n  after the EC2 fleet API call.\r\n\r\n* Convert tests for createRunInstancesInput to createLaunchTemplateData\r\n\r\n* Small log message fix\r\n\r\n* Add additional EC2 mocks\r\n\r\n* Implement support for configurable Spot allocation strategies\r\n\r\n- Added global config with per-ASG tag overrides\r\n- Extended unit test coverage for the new logic\r\n- Improved tests for reading other configurations from tags\r\n- Added unit tests for EBS block device conversion logic\r\n- Converted PatchBeanstalkUserdata config flag to bool value\r\n\r\n* Move small utility functions to util.go\r\n\r\n* Fix codeclimate issue\r\n\r\n* Extract complex if condition into its own function, pass instance type information by reference\r\n\r\n* Further simplifications for codeclimate\r\n\r\n* Use latest version of golang and build for amd64\r\n\r\n* Expose spot_allocation_strategy on CloudFormation\r\n\r\n* Ensure the AMI ID comes from the LaunchConfiguration/Template\r\n\r\n* Add required IAM permissions\r\n\r\n* Set priority for capacity-optimized-prioritized\r\n\r\n* Pass missing LaunchTemplate fields, such as UserData and KeyName\r\n\r\n* Expand test coverage\r\n\r\n* Document the capacity-optimized prioritized\r\n\r\n* Small readme changes"}},"url":"https://api.github.com/repos/cloudutil/AutoSpotting/commits/ff96e8f9963735fb60dd640ecd3de9035c85c9c4","html_url":"https://github.com/cloudutil/AutoSpotting/commit/ff96e8f9963735fb60dd640ecd3de9035c85c9c4","comments_url":"https://api.github.com/repos/cloudutil/AutoSpotting/commits/ff96e8f9963735fb60dd640ecd3de9035c85c9c4/comments","author":{"login":"cristim","id":95209,"node_id":"MDQ6VXNlcjk1MjA5","avatar_url":"https://avatars.githubusercontent.com/u/95209?v=4","gravatar_id":"","url":"https://api.github.com/users/cristim","html_url":"https://github.com/cristim","followers_url":"https://api.github.com/users/cristim/followers","following_url":"https://api.github.com/users/cristim/following{/other_user}","gists_url":"https://api.github.com/users/cristim/gists{/gist_id}","starred_url":"https://api.github.com/users/cristim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cristim/subscriptions","organizations_url":"https://api.github.com/users/cristim/orgs","repos_url":"https://api.github.com/users/cristim/repos","events_url":"https://api.github.com/users/cristim/events{/privacy}","received_events_url":"https://api.github.com/users/cristim/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"751b4cc1b0cdd5f6523f2828d92f31c3c5e223f2","url":"https://api.github.com/repos/cloudutil/AutoSpotting/commits/751b4cc1b0cdd5f6523f2828d92f31c3c5e223f2","html_url":"https://github.com/cloudutil/AutoSpotting/commit/751b4cc1b0cdd5f6523f2828d92f31c3c5e223f2"}]}]