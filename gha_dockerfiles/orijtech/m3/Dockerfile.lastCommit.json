[{"sha":"749cad8a4458247a128312ac7eedad6a2c63ca28","node_id":"MDY6Q29tbWl0NDEyMjU4NDgxOjc0OWNhZDhhNDQ1ODI0N2ExMjgzMTJhYzdlZWRhZDZhMmM2M2NhMjg=","commit":{"author":{"name":"λinas","email":"soundvibe@users.noreply.github.com","date":"2021-07-21T07:05:21Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2021-07-21T07:05:21Z"},"message":"[dbnode] Ensure that all cached file descriptors are closed (#3600)\n\n* Ensure that all  cached data file descriptors are closed when shards are closed.\r\nAdded few regression integration tests.\r\n\r\n* close seekers only for a given shard.\r\n\r\n* fixed failing test.\r\n\r\n* fixed failing unit test.\r\n\r\n* fixed failing unit test.\r\n\r\n* fixed failing unit test.\r\n\r\n* trying to fix flaky integration test.\r\n\r\n* trying to fix flaky integration tests.\r\n\r\n* trying to fix flaky integration tests.\r\n\r\n* trying to fix integration tests (1)\r\n\r\n* trying to fix integration tests (2)\r\n\r\n* trying to fix integration tests (4)\r\n\r\n* trying to fix integration tests (5)\r\n\r\n* trying to fix integration tests (6)\r\n\r\n* added Dockerfile to install `lsof` for integration tests.\r\n\r\n* specify docker compose version\r\n\r\n* specify docker compose version\r\n\r\n* removed debug code.\r\n\r\n* cleaned up some code.\r\n\r\n* changes after review.\r\nimproved seek manager test.\r\n\r\n* Removed closing of seekers during shard's Close(). SeekerMgr will eventually close them inside openCloseLoop. Added blockRetriever.Close() when the namespace is closed because seekerMgr is not being closed when database and namespace closes.\r\nAdded `StopServerAndVerifyOpenFilesAreClosed()` method to TestSetup.","tree":{"sha":"46ca176a30341904580d6818546ffd11537d0cc9","url":"https://api.github.com/repos/orijtech/m3/git/trees/46ca176a30341904580d6818546ffd11537d0cc9"},"url":"https://api.github.com/repos/orijtech/m3/git/commits/749cad8a4458247a128312ac7eedad6a2c63ca28","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg98cxCRBK7hj4Ov3rIwAAq90IAEaZLb6sG56AHIjmTiyGSAjc\nZxU2USDDIYoffBEnFaJM1ygLhSRNzHgDTnIrbDWXVqkJpAxG7eLN0U2Acu8DKN8J\n00qSLniFN41qx+LKKfx7fUA9Q7hihS5kMo2X/3BpfhroO9sDmHuVkptJWO/2AQBZ\nn7k3VZBgZcwKcnAaBiIxGsl5DruB5BWngzMsv/hn+gvbMs8gEbpp5TSPmmjl54n8\nb6XOCJYo7teBG64QVyPn2KNN+BgHVhifO+UesNuBtTtTukveZlJykDds/Wao2Nw1\nEO+/hpiUHieJLbZeSf8t5QJUOv8RFmFriKqyjELyTiGzeQd41d3+iqt5b/Igxcg=\n=U9ep\n-----END PGP SIGNATURE-----\n","payload":"tree 46ca176a30341904580d6818546ffd11537d0cc9\nparent 82f4543c662f2bf77ce96957e5212be5d0839e6a\nauthor λinas <soundvibe@users.noreply.github.com> 1626851121 +0300\ncommitter GitHub <noreply@github.com> 1626851121 +0300\n\n[dbnode] Ensure that all cached file descriptors are closed (#3600)\n\n* Ensure that all  cached data file descriptors are closed when shards are closed.\r\nAdded few regression integration tests.\r\n\r\n* close seekers only for a given shard.\r\n\r\n* fixed failing test.\r\n\r\n* fixed failing unit test.\r\n\r\n* fixed failing unit test.\r\n\r\n* fixed failing unit test.\r\n\r\n* trying to fix flaky integration test.\r\n\r\n* trying to fix flaky integration tests.\r\n\r\n* trying to fix flaky integration tests.\r\n\r\n* trying to fix integration tests (1)\r\n\r\n* trying to fix integration tests (2)\r\n\r\n* trying to fix integration tests (4)\r\n\r\n* trying to fix integration tests (5)\r\n\r\n* trying to fix integration tests (6)\r\n\r\n* added Dockerfile to install `lsof` for integration tests.\r\n\r\n* specify docker compose version\r\n\r\n* specify docker compose version\r\n\r\n* removed debug code.\r\n\r\n* cleaned up some code.\r\n\r\n* changes after review.\r\nimproved seek manager test.\r\n\r\n* Removed closing of seekers during shard's Close(). SeekerMgr will eventually close them inside openCloseLoop. Added blockRetriever.Close() when the namespace is closed because seekerMgr is not being closed when database and namespace closes.\r\nAdded `StopServerAndVerifyOpenFilesAreClosed()` method to TestSetup."}},"url":"https://api.github.com/repos/orijtech/m3/commits/749cad8a4458247a128312ac7eedad6a2c63ca28","html_url":"https://github.com/orijtech/m3/commit/749cad8a4458247a128312ac7eedad6a2c63ca28","comments_url":"https://api.github.com/repos/orijtech/m3/commits/749cad8a4458247a128312ac7eedad6a2c63ca28/comments","author":{"login":"soundvibe","id":1712879,"node_id":"MDQ6VXNlcjE3MTI4Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/1712879?v=4","gravatar_id":"","url":"https://api.github.com/users/soundvibe","html_url":"https://github.com/soundvibe","followers_url":"https://api.github.com/users/soundvibe/followers","following_url":"https://api.github.com/users/soundvibe/following{/other_user}","gists_url":"https://api.github.com/users/soundvibe/gists{/gist_id}","starred_url":"https://api.github.com/users/soundvibe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/soundvibe/subscriptions","organizations_url":"https://api.github.com/users/soundvibe/orgs","repos_url":"https://api.github.com/users/soundvibe/repos","events_url":"https://api.github.com/users/soundvibe/events{/privacy}","received_events_url":"https://api.github.com/users/soundvibe/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"82f4543c662f2bf77ce96957e5212be5d0839e6a","url":"https://api.github.com/repos/orijtech/m3/commits/82f4543c662f2bf77ce96957e5212be5d0839e6a","html_url":"https://github.com/orijtech/m3/commit/82f4543c662f2bf77ce96957e5212be5d0839e6a"}]}]