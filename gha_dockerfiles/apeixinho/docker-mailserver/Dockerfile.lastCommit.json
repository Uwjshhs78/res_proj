[{"sha":"4db546d300bbb0ba26afe7df40deac91810a7782","node_id":"MDY6Q29tbWl0MjIzMjU4NTA4OjRkYjU0NmQzMDBiYmIwYmEyNmFmZTdkZjQwZGVhYzkxODEwYTc3ODI=","commit":{"author":{"name":"Brennan Kinney","email":"5098581+polarathene@users.noreply.github.com","date":"2021-09-19T12:36:26Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2021-09-19T12:36:26Z"},"message":"fix: Don't needlessly invalidate cache layers (#2197)\n\nRecent `sedfile` addition moved all scripts section earlier into the Dockerfile so that `sedfile` could be used within the Dockerfile.\r\n\r\nHowever whenever a change is made to scripts which is most of the time for this project, building the Docker image for tests results in all layers after the scripts being invalidated, notably ClamAV, wasting storage of previous instances and increasing build time unnecessarily.\r\n\r\nThis isn't as noticeable of an issue via the CI as we don't leverage any caching at present there, but for iterating on a local branch and testing, it can be quite the drawback.\r\n\r\n- `sedfile` is handled early in the Dockerfile still, while the scripts have been moved as far down as it made sense to.\r\n- `chmod` was split out into it's own RUN command as again it's unnecessary for the rest of it's prior RUN command group to be invalidated.","tree":{"sha":"b75bb3b4b90cca83360d44aec9d5f2b769f13bb8","url":"https://api.github.com/repos/apeixinho/docker-mailserver/git/trees/b75bb3b4b90cca83360d44aec9d5f2b769f13bb8"},"url":"https://api.github.com/repos/apeixinho/docker-mailserver/git/commits/4db546d300bbb0ba26afe7df40deac91810a7782","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhRy7KCRBK7hj4Ov3rIwAApiEIADgK5CbfcG7OpKWMmQ1ySls9\nRZ+mwyGR2KTlUj9ioBbPowiUcTgvO7YUOtsBoY18/+zxgFbQdbPea6+w7AR7sAYz\nl7v4ojogCcdrmqEelJyuSzZoYoLE74AqlHBsSILNfwq2EnCqLRC9e5f2BV927ONH\nKAXjPVH+7KXOSbhtZ3J9z4PW1Znf4rx5DYHID0fYMWscgwCy0zhMspC8ZZxeOLK7\nDQeV8AwWlAVWpzMd01U3+sST4i2evA5jmg0q3Wk5bDjbLS2JP6YEP0wkn45lIJge\nJRrTORAqzmvKiOk8vWRtf4hI08FIuvuRywmWfFVZXya1mH+dXZUohQv8uSF2a6c=\n=dQBP\n-----END PGP SIGNATURE-----\n","payload":"tree b75bb3b4b90cca83360d44aec9d5f2b769f13bb8\nparent c851f5b6aa59d24b6d52b4d7fd2923bd5f4f64bf\nauthor Brennan Kinney <5098581+polarathene@users.noreply.github.com> 1632054986 +1200\ncommitter GitHub <noreply@github.com> 1632054986 +0000\n\nfix: Don't needlessly invalidate cache layers (#2197)\n\nRecent `sedfile` addition moved all scripts section earlier into the Dockerfile so that `sedfile` could be used within the Dockerfile.\r\n\r\nHowever whenever a change is made to scripts which is most of the time for this project, building the Docker image for tests results in all layers after the scripts being invalidated, notably ClamAV, wasting storage of previous instances and increasing build time unnecessarily.\r\n\r\nThis isn't as noticeable of an issue via the CI as we don't leverage any caching at present there, but for iterating on a local branch and testing, it can be quite the drawback.\r\n\r\n- `sedfile` is handled early in the Dockerfile still, while the scripts have been moved as far down as it made sense to.\r\n- `chmod` was split out into it's own RUN command as again it's unnecessary for the rest of it's prior RUN command group to be invalidated."}},"url":"https://api.github.com/repos/apeixinho/docker-mailserver/commits/4db546d300bbb0ba26afe7df40deac91810a7782","html_url":"https://github.com/apeixinho/docker-mailserver/commit/4db546d300bbb0ba26afe7df40deac91810a7782","comments_url":"https://api.github.com/repos/apeixinho/docker-mailserver/commits/4db546d300bbb0ba26afe7df40deac91810a7782/comments","author":{"login":"polarathene","id":5098581,"node_id":"MDQ6VXNlcjUwOTg1ODE=","avatar_url":"https://avatars.githubusercontent.com/u/5098581?v=4","gravatar_id":"","url":"https://api.github.com/users/polarathene","html_url":"https://github.com/polarathene","followers_url":"https://api.github.com/users/polarathene/followers","following_url":"https://api.github.com/users/polarathene/following{/other_user}","gists_url":"https://api.github.com/users/polarathene/gists{/gist_id}","starred_url":"https://api.github.com/users/polarathene/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polarathene/subscriptions","organizations_url":"https://api.github.com/users/polarathene/orgs","repos_url":"https://api.github.com/users/polarathene/repos","events_url":"https://api.github.com/users/polarathene/events{/privacy}","received_events_url":"https://api.github.com/users/polarathene/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"c851f5b6aa59d24b6d52b4d7fd2923bd5f4f64bf","url":"https://api.github.com/repos/apeixinho/docker-mailserver/commits/c851f5b6aa59d24b6d52b4d7fd2923bd5f4f64bf","html_url":"https://github.com/apeixinho/docker-mailserver/commit/c851f5b6aa59d24b6d52b4d7fd2923bd5f4f64bf"}]}]