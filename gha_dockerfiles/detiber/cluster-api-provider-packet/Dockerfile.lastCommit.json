[{"sha":"824fcfee4a2ab8f0e81b05f3ea473295ed520ffa","node_id":"C_kwDOES693doAKDgyNGZjZmVlNGEyYWI4ZjBlODFiMDVmM2VhNDczMjk1ZWQ1MjBmZmE","commit":{"author":{"name":"Jason DeTiberus","email":"detiber@users.noreply.github.com","date":"2021-07-08T17:18:16Z"},"committer":{"name":"Jason DeTiberus","email":"detiber@users.noreply.github.com","date":"2021-10-25T16:30:34Z"},"message":"Cluster API v1alpha4 updates and support newer versions of the Equinix Metal cloud provider\n\nCluster API v1alpha4 changes:\n- Update dependencies and make provider changes necessary to support Cluster API v1alpha4\n- Rework e2e tests to better leverage upstream e2e test framework and upstream provided test specs\n- Rework pr-based github actions to enable smoketesting of PRs using the quickstart e2e test\n- Rework push based github actions to enable full e2e tests when changes are merged\n- Rework relese workflow to not be dependent on push workflow\n\nUpdated cloud-provider support:\n- Deploy the latest version of cloud-provider-equinix-metal by default with templates\n- Update providerID prefix used from packet:// to equinixmetal:// to align with cloud-provider-equinix-metal\n- Provide capp-helper migration tool to support upgrading the cloud provider on existing workload clusters and migrating the providerID for existing Nodes to facilitate migrating from packet-ccm to cloud-provider-equinix-metal\n\na bit of cleanup\n\nAdd additional helpers to wrappedClusterProxy to avoid intermittent issues getting the workload cluster client when handling deletion/remediation of control plane instances\n\nAttempt to cleanup EIPs following e2e tests\n\nRev cloud-provider-equinix-metal to latest version in templates\n\nImprove cleanup of EIPs following e2e tests\n\nMake EIP cleanup work across ginkgo nodes\n\nBump packngo to latest\n\nBump github.com/google/uuid from 1.2.0 to 1.3.0\n\nBumps [github.com/google/uuid](https://github.com/google/uuid) from 1.2.0 to 1.3.0.\n- [Release notes](https://github.com/google/uuid/releases)\n- [Commits](https://github.com/google/uuid/compare/v1.2.0...v1.3.0)\n\n---\nupdated-dependencies:\n- dependency-name: github.com/google/uuid\n  dependency-type: direct:production\n  update-type: version-update:semver-minor\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>\n\nBump github.com/onsi/gomega from 1.15.0 to 1.16.0\n\nBumps [github.com/onsi/gomega](https://github.com/onsi/gomega) from 1.15.0 to 1.16.0.\n- [Release notes](https://github.com/onsi/gomega/releases)\n- [Changelog](https://github.com/onsi/gomega/blob/master/CHANGELOG.md)\n- [Commits](https://github.com/onsi/gomega/compare/v1.15.0...v1.16.0)\n\n---\nupdated-dependencies:\n- dependency-name: github.com/onsi/gomega\n  dependency-type: direct:production\n  update-type: version-update:semver-minor\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>\n\nupdate capi to v0.4.2, update e2e tests accordingly\n\nFix e2e test configs\n\nstop matrix jobs from failing fast to avoid orphaning resources\n\nAdd a cli tool to cleanup CI and a github workflow to run it on a schedule\n\nfix cleanup workflow\n\nChange default instance to c1.small.x86 for e2e tests, allow easier configuration of plan types for e2e tests, and actually show what facility, ssh key, and plans are being used by tests\n\nReduce duplication of workflows with a composite action\n\nFixes and further improvements\n\n- Rename ErrorMessage/ErrorReason to align with upstream (which made this change in v1alpha3)\n- Add conditions to align with upstream\n- Improve re-entrancy of PacketMachine controller, by standardizing tags,\n  and doing a lookup by tags if providerID is not recorded\n- Enable support for a comma separated list of hardwareReservationIDs\n\nfix up path to action in github workflows\n\nFixup composite github aciton\n\nfixup go.mod\n\nupdate generated code\n\nDisable kcp upgrade related tests until they can be deflaked\n\nAllow removing the finalizer for a packetmachine when a machine fails to provision\n\nFixup ginkgo extra args in makefile\n\nFix log message\n\nAdd a cluster template for no cpem, update cluster template to use kube-vip, and rename e2e test CRS for cni\n\nre-enable kcp-upgrade test\n\nRe-enable all the e2e tests\n\nUpdate templates, use daemonset for kube-vip, start e2e test for updgrade involving kube-vip\n\nappease linter\n\npatch up e2e test runs with separate module\n\nAdd migration tooling to migrate workload clusters to kube-vip\n\nbump controller-runtime and k8s dependencies\n\nUse latest head for cluster-api/test/e2e and add tests for clusters without CPEM enabled\n\nAdd PacketCluster to cluster-api category\n\nbump golang to v1.16.8 and move release of capp-helper to container image\n\nFix pr workflow\n\nmanifest fixes\n\nRe-enable scheduled tests, limit concurrency, remove pr-based e2e tests\n\nRestructure templates and e2e tests to enable splitting out tests more granularly for testing\n\nbump dependencies\n\nImprove caching and parallelism for github actions\n\nfix e2e test configs\n\nfix helper after bumping ui dependencies\n\nFix broken test relese workflow and try to improve tool caching\n\nimprove caching for validate test job\n\nfix e2e test template w/ cpem\n\noverride default leader election config for kube-vip\n\nfix typo in templates\n\nupdate e2e test template\n\nswitch to static pod manifests\n\nAttempt to improve caching for workflows\n\nfix flavor used for kcp upgrade scale-in testing\n\nUpdate test configs and calico\n\nfix e2e test configs\n\nDecrease frequency of scheduled ci job to every 6 hours\n\nSwitch calico to use vxlan instead of ipip\n\nbump tooling to latest versions\n\nremove helper\n\nupdate cluster template\n\nupdate templates\n\nupdate e2e test templates\n\nupdate makefile for template changes\n\nmore updates to remove helper and serialize e2e tests\n\nfix go mod\n\nmore fixes","tree":{"sha":"43914a820b5d0f8ca7fd6b56bc14328e12488e81","url":"https://api.github.com/repos/detiber/cluster-api-provider-packet/git/trees/43914a820b5d0f8ca7fd6b56bc14328e12488e81"},"url":"https://api.github.com/repos/detiber/cluster-api-provider-packet/git/commits/824fcfee4a2ab8f0e81b05f3ea473295ed520ffa","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEJGXJwYViIkrj9Tvby9fXpLQUN7wFAmF227IACgkQy9fXpLQU\nN7z0jQ//YCUW2P5YduGu/T6RjVuNA/Mke9ipQH5RtpzSHkzDB1sUciEx6J2pr+rV\nDpcUunItrrlgSDPD6vZCDRcdkDCc+v90VHlG+vWVqfjwAq7DYeUnNwJ2UUOM7AV8\nUVxTfr/0961+CbuMkDJACCCHpbLpTmjAXzRDIMa1/7pAOBXY/GTWNVOkL1kuqoD9\nz9geNh1KRQfvmOcRNTZjdnaWDs7eqp645Z5MGXWnoDT/c2P6C67ClWjgBtrkBfD0\nLXNk2mQxYLPR+SvWRh0DV699TbIuKPF3js23L/zaQnFda3XyzamX3mefBqSt9EW9\nW+aqJoC6CerlIYxxgvLcLfnoCnWr5rBFXlfxDeMBEamawYzGEEg8hE/FK5VlJrb+\nC3Cv359yt7qtthUNOo/5zq6jQiAwZQMavPIUITc/Hu99JZLajxIuEbdENX4wFujw\nnjHKPw/6zACEig6+wDPaPsT8/TC81Xv9MG4vzGVXwsihqjYES5eijVoKI5GB+59L\nuXQbk2cekhZRWDMPV/7n6qOHUc/5kN+iVjJ4DRB4ZT4S0rcjqH24S4rJg/ZyCszL\nhcS7wcKtYdUk+AASZU8glyVdj0462NEOM0c99pv4PMSq7RhWZcI1w0JPCG0yC9YO\nhlpwyYjwkSBMOaI6TE9410VxpU0fnVxOyMkya8AlIuaZApKEFKE=\n=X6qy\n-----END PGP SIGNATURE-----","payload":"tree 43914a820b5d0f8ca7fd6b56bc14328e12488e81\nparent 13ab6e68d7285f0008ff3406a1e1e3daae68a7f7\nauthor Jason DeTiberus <detiber@users.noreply.github.com> 1625764696 -0400\ncommitter Jason DeTiberus <detiber@users.noreply.github.com> 1635179434 -0400\n\nCluster API v1alpha4 updates and support newer versions of the Equinix Metal cloud provider\n\nCluster API v1alpha4 changes:\n- Update dependencies and make provider changes necessary to support Cluster API v1alpha4\n- Rework e2e tests to better leverage upstream e2e test framework and upstream provided test specs\n- Rework pr-based github actions to enable smoketesting of PRs using the quickstart e2e test\n- Rework push based github actions to enable full e2e tests when changes are merged\n- Rework relese workflow to not be dependent on push workflow\n\nUpdated cloud-provider support:\n- Deploy the latest version of cloud-provider-equinix-metal by default with templates\n- Update providerID prefix used from packet:// to equinixmetal:// to align with cloud-provider-equinix-metal\n- Provide capp-helper migration tool to support upgrading the cloud provider on existing workload clusters and migrating the providerID for existing Nodes to facilitate migrating from packet-ccm to cloud-provider-equinix-metal\n\na bit of cleanup\n\nAdd additional helpers to wrappedClusterProxy to avoid intermittent issues getting the workload cluster client when handling deletion/remediation of control plane instances\n\nAttempt to cleanup EIPs following e2e tests\n\nRev cloud-provider-equinix-metal to latest version in templates\n\nImprove cleanup of EIPs following e2e tests\n\nMake EIP cleanup work across ginkgo nodes\n\nBump packngo to latest\n\nBump github.com/google/uuid from 1.2.0 to 1.3.0\n\nBumps [github.com/google/uuid](https://github.com/google/uuid) from 1.2.0 to 1.3.0.\n- [Release notes](https://github.com/google/uuid/releases)\n- [Commits](https://github.com/google/uuid/compare/v1.2.0...v1.3.0)\n\n---\nupdated-dependencies:\n- dependency-name: github.com/google/uuid\n  dependency-type: direct:production\n  update-type: version-update:semver-minor\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>\n\nBump github.com/onsi/gomega from 1.15.0 to 1.16.0\n\nBumps [github.com/onsi/gomega](https://github.com/onsi/gomega) from 1.15.0 to 1.16.0.\n- [Release notes](https://github.com/onsi/gomega/releases)\n- [Changelog](https://github.com/onsi/gomega/blob/master/CHANGELOG.md)\n- [Commits](https://github.com/onsi/gomega/compare/v1.15.0...v1.16.0)\n\n---\nupdated-dependencies:\n- dependency-name: github.com/onsi/gomega\n  dependency-type: direct:production\n  update-type: version-update:semver-minor\n...\n\nSigned-off-by: dependabot[bot] <support@github.com>\n\nupdate capi to v0.4.2, update e2e tests accordingly\n\nFix e2e test configs\n\nstop matrix jobs from failing fast to avoid orphaning resources\n\nAdd a cli tool to cleanup CI and a github workflow to run it on a schedule\n\nfix cleanup workflow\n\nChange default instance to c1.small.x86 for e2e tests, allow easier configuration of plan types for e2e tests, and actually show what facility, ssh key, and plans are being used by tests\n\nReduce duplication of workflows with a composite action\n\nFixes and further improvements\n\n- Rename ErrorMessage/ErrorReason to align with upstream (which made this change in v1alpha3)\n- Add conditions to align with upstream\n- Improve re-entrancy of PacketMachine controller, by standardizing tags,\n  and doing a lookup by tags if providerID is not recorded\n- Enable support for a comma separated list of hardwareReservationIDs\n\nfix up path to action in github workflows\n\nFixup composite github aciton\n\nfixup go.mod\n\nupdate generated code\n\nDisable kcp upgrade related tests until they can be deflaked\n\nAllow removing the finalizer for a packetmachine when a machine fails to provision\n\nFixup ginkgo extra args in makefile\n\nFix log message\n\nAdd a cluster template for no cpem, update cluster template to use kube-vip, and rename e2e test CRS for cni\n\nre-enable kcp-upgrade test\n\nRe-enable all the e2e tests\n\nUpdate templates, use daemonset for kube-vip, start e2e test for updgrade involving kube-vip\n\nappease linter\n\npatch up e2e test runs with separate module\n\nAdd migration tooling to migrate workload clusters to kube-vip\n\nbump controller-runtime and k8s dependencies\n\nUse latest head for cluster-api/test/e2e and add tests for clusters without CPEM enabled\n\nAdd PacketCluster to cluster-api category\n\nbump golang to v1.16.8 and move release of capp-helper to container image\n\nFix pr workflow\n\nmanifest fixes\n\nRe-enable scheduled tests, limit concurrency, remove pr-based e2e tests\n\nRestructure templates and e2e tests to enable splitting out tests more granularly for testing\n\nbump dependencies\n\nImprove caching and parallelism for github actions\n\nfix e2e test configs\n\nfix helper after bumping ui dependencies\n\nFix broken test relese workflow and try to improve tool caching\n\nimprove caching for validate test job\n\nfix e2e test template w/ cpem\n\noverride default leader election config for kube-vip\n\nfix typo in templates\n\nupdate e2e test template\n\nswitch to static pod manifests\n\nAttempt to improve caching for workflows\n\nfix flavor used for kcp upgrade scale-in testing\n\nUpdate test configs and calico\n\nfix e2e test configs\n\nDecrease frequency of scheduled ci job to every 6 hours\n\nSwitch calico to use vxlan instead of ipip\n\nbump tooling to latest versions\n\nremove helper\n\nupdate cluster template\n\nupdate templates\n\nupdate e2e test templates\n\nupdate makefile for template changes\n\nmore updates to remove helper and serialize e2e tests\n\nfix go mod\n\nmore fixes\n"}},"url":"https://api.github.com/repos/detiber/cluster-api-provider-packet/commits/824fcfee4a2ab8f0e81b05f3ea473295ed520ffa","html_url":"https://github.com/detiber/cluster-api-provider-packet/commit/824fcfee4a2ab8f0e81b05f3ea473295ed520ffa","comments_url":"https://api.github.com/repos/detiber/cluster-api-provider-packet/commits/824fcfee4a2ab8f0e81b05f3ea473295ed520ffa/comments","author":{"login":"detiber","id":915544,"node_id":"MDQ6VXNlcjkxNTU0NA==","avatar_url":"https://avatars.githubusercontent.com/u/915544?v=4","gravatar_id":"","url":"https://api.github.com/users/detiber","html_url":"https://github.com/detiber","followers_url":"https://api.github.com/users/detiber/followers","following_url":"https://api.github.com/users/detiber/following{/other_user}","gists_url":"https://api.github.com/users/detiber/gists{/gist_id}","starred_url":"https://api.github.com/users/detiber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/detiber/subscriptions","organizations_url":"https://api.github.com/users/detiber/orgs","repos_url":"https://api.github.com/users/detiber/repos","events_url":"https://api.github.com/users/detiber/events{/privacy}","received_events_url":"https://api.github.com/users/detiber/received_events","type":"User","site_admin":false},"committer":{"login":"detiber","id":915544,"node_id":"MDQ6VXNlcjkxNTU0NA==","avatar_url":"https://avatars.githubusercontent.com/u/915544?v=4","gravatar_id":"","url":"https://api.github.com/users/detiber","html_url":"https://github.com/detiber","followers_url":"https://api.github.com/users/detiber/followers","following_url":"https://api.github.com/users/detiber/following{/other_user}","gists_url":"https://api.github.com/users/detiber/gists{/gist_id}","starred_url":"https://api.github.com/users/detiber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/detiber/subscriptions","organizations_url":"https://api.github.com/users/detiber/orgs","repos_url":"https://api.github.com/users/detiber/repos","events_url":"https://api.github.com/users/detiber/events{/privacy}","received_events_url":"https://api.github.com/users/detiber/received_events","type":"User","site_admin":false},"parents":[{"sha":"13ab6e68d7285f0008ff3406a1e1e3daae68a7f7","url":"https://api.github.com/repos/detiber/cluster-api-provider-packet/commits/13ab6e68d7285f0008ff3406a1e1e3daae68a7f7","html_url":"https://github.com/detiber/cluster-api-provider-packet/commit/13ab6e68d7285f0008ff3406a1e1e3daae68a7f7"}]}]