[{"sha":"490880bf5ab5b43aa2b6d3087a2fa3506f4a1fed","node_id":"C_kwDOAB51LdoAKDQ5MDg4MGJmNWFiNWI0M2FhMmI2ZDMwODdhMmZhMzUwNmY0YTFmZWQ","commit":{"author":{"name":"Karl Baker","email":"karl.baker@digital.cabinet-office.gov.uk","date":"2021-11-02T15:53:15Z"},"committer":{"name":"Karl Baker","email":"karl.baker@digital.cabinet-office.gov.uk","date":"2021-11-04T14:27:56Z"},"message":"Streamline Publisher Docker image\n\nThis commit streamlines the Publisher image by installing dependencies\netc in a new intermediate `builder` stage, before copying back the build\noutputs to the output image.\n\nWe add a .dockerignore to omit files and directories which aren't needed\nat runtime.\n\nWe set RAILS_ENV to production and remove HEALTHCHECK and PORT (since\nthese are not used in Kubernetes and would only serve to add ambiguity).\n\nFor now, the compiled Rails assets are still included in the output\nimage, even though they're unlikely to be of much use. We'll need assets\nto be uploaded to a static serving service as a deployment step,\notherwise rolling updates won't be possible (because each pod would only\nhave the assets from its own version, not the next/previous version).\n\nAlternatives considered: We tried using the Bitnami ruby images (which\nhave an attractive support/update policy) but ran into difficulties with\nbundler and versions/locations of gems.\n\nCo-authored-by: Chris Banks <chris.banks@digital.cabinet-office.gov.uk>","tree":{"sha":"a61b808783c869f7c4670c17e9161b0263d5a6b6","url":"https://api.github.com/repos/alphagov/publisher/git/trees/a61b808783c869f7c4670c17e9161b0263d5a6b6"},"url":"https://api.github.com/repos/alphagov/publisher/git/commits/490880bf5ab5b43aa2b6d3087a2fa3506f4a1fed","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/alphagov/publisher/commits/490880bf5ab5b43aa2b6d3087a2fa3506f4a1fed","html_url":"https://github.com/alphagov/publisher/commit/490880bf5ab5b43aa2b6d3087a2fa3506f4a1fed","comments_url":"https://api.github.com/repos/alphagov/publisher/commits/490880bf5ab5b43aa2b6d3087a2fa3506f4a1fed/comments","author":{"login":"karlbaker02","id":5422487,"node_id":"MDQ6VXNlcjU0MjI0ODc=","avatar_url":"https://avatars.githubusercontent.com/u/5422487?v=4","gravatar_id":"","url":"https://api.github.com/users/karlbaker02","html_url":"https://github.com/karlbaker02","followers_url":"https://api.github.com/users/karlbaker02/followers","following_url":"https://api.github.com/users/karlbaker02/following{/other_user}","gists_url":"https://api.github.com/users/karlbaker02/gists{/gist_id}","starred_url":"https://api.github.com/users/karlbaker02/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlbaker02/subscriptions","organizations_url":"https://api.github.com/users/karlbaker02/orgs","repos_url":"https://api.github.com/users/karlbaker02/repos","events_url":"https://api.github.com/users/karlbaker02/events{/privacy}","received_events_url":"https://api.github.com/users/karlbaker02/received_events","type":"User","site_admin":false},"committer":{"login":"karlbaker02","id":5422487,"node_id":"MDQ6VXNlcjU0MjI0ODc=","avatar_url":"https://avatars.githubusercontent.com/u/5422487?v=4","gravatar_id":"","url":"https://api.github.com/users/karlbaker02","html_url":"https://github.com/karlbaker02","followers_url":"https://api.github.com/users/karlbaker02/followers","following_url":"https://api.github.com/users/karlbaker02/following{/other_user}","gists_url":"https://api.github.com/users/karlbaker02/gists{/gist_id}","starred_url":"https://api.github.com/users/karlbaker02/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlbaker02/subscriptions","organizations_url":"https://api.github.com/users/karlbaker02/orgs","repos_url":"https://api.github.com/users/karlbaker02/repos","events_url":"https://api.github.com/users/karlbaker02/events{/privacy}","received_events_url":"https://api.github.com/users/karlbaker02/received_events","type":"User","site_admin":false},"parents":[{"sha":"4bc134d2fd8c59bb128db52defbb30f152f3e6dc","url":"https://api.github.com/repos/alphagov/publisher/commits/4bc134d2fd8c59bb128db52defbb30f152f3e6dc","html_url":"https://github.com/alphagov/publisher/commit/4bc134d2fd8c59bb128db52defbb30f152f3e6dc"}]}]