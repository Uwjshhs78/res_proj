[{"sha":"f0c85571edcebf7ec4b2221f2e2a257421da0947","node_id":"MDY6Q29tbWl0MTgzNTE4NzU3OmYwYzg1NTcxZWRjZWJmN2VjNGIyMjIxZjJlMmEyNTc0MjFkYTA5NDc=","commit":{"author":{"name":"Eli Uriegas","email":"eliuriegas@fb.com","date":"2020-01-24T18:24:46Z"},"committer":{"name":"Facebook Github Bot","email":"facebook-github-bot@users.noreply.github.com","date":"2020-01-24T18:27:20Z"},"message":"docker: Refactor Dockerfile process for official images (#32515)\n\nSummary:\n## Commit Message:\n\nRefactors Dockerfile to be as parallel as possible with caching and adds a new Makefile to build said Dockerfile.\n\nAlso updated the README.md to reflect the changes as well as updated some of the verbage around running our latest Docker images.\n\nAdds the new Dockerfile process to our CircleCI workflows\n\n## How to build:\n\nBuilding the new images is pretty simple, just requires `docker` > 18.06 since the new build process relies on `buildkit` caching and multi-stage build resolving.\n\n### Development images\nFor `runtime` images:\n```\nmake -f docker.Makefile runtime-image\n```\n\nFor `devel` images:\n```\nmake -f docker.Makefile devel-image\n```\n\nBuilds are tagged as follows:\n```bash\ndocker.io/${docker_user:-whoami}/pytorch:$(git describe --tags)-${image_type}\n```\n\nExample:\n```\ndocker.io/seemethere/pytorch:v1.4.0a0-2225-g9eba97b61d-runtime\n```\n\n### Official images\n\nOfficial images are the ones hosted on [`docker.io/pytorch/pytorch`](https://hub.docker.com/r/pytorch/pytorch)\n\nTo do official images builds you can simply add set the `BUILD_TYPE` variable to `official` and it will do the correct build without building the local binaries:\n\nExample:\n```\nmake -f docker.Makefile BUILD_TYPE=official runtime-image\n```\n\n## How to push:\n\nPushing is also super simple (And will automatically tag the right thing based off of the git tag):\n\n```\nmake -f docker.Makefile runtime-push\nmake -f docker.Makefile devel-push\n```\nSigned-off-by: Eli Uriegas <eliuriegas@fb.com>\nPull Request resolved: https://github.com/pytorch/pytorch/pull/32515\n\nDifferential Revision: D19558619\n\nPulled By: seemethere\n\nfbshipit-source-id: a06b25cd39ae9890751a60f8f36739ad6ab9ac99","tree":{"sha":"47fafd404ec11ae3943772385dce98329e3cfe58","url":"https://api.github.com/repos/zhaojuanmao/pytorch/git/trees/47fafd404ec11ae3943772385dce98329e3cfe58"},"url":"https://api.github.com/repos/zhaojuanmao/pytorch/git/commits/f0c85571edcebf7ec4b2221f2e2a257421da0947","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/zhaojuanmao/pytorch/commits/f0c85571edcebf7ec4b2221f2e2a257421da0947","html_url":"https://github.com/zhaojuanmao/pytorch/commit/f0c85571edcebf7ec4b2221f2e2a257421da0947","comments_url":"https://api.github.com/repos/zhaojuanmao/pytorch/commits/f0c85571edcebf7ec4b2221f2e2a257421da0947/comments","author":{"login":"seemethere","id":1700823,"node_id":"MDQ6VXNlcjE3MDA4MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1700823?v=4","gravatar_id":"","url":"https://api.github.com/users/seemethere","html_url":"https://github.com/seemethere","followers_url":"https://api.github.com/users/seemethere/followers","following_url":"https://api.github.com/users/seemethere/following{/other_user}","gists_url":"https://api.github.com/users/seemethere/gists{/gist_id}","starred_url":"https://api.github.com/users/seemethere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seemethere/subscriptions","organizations_url":"https://api.github.com/users/seemethere/orgs","repos_url":"https://api.github.com/users/seemethere/repos","events_url":"https://api.github.com/users/seemethere/events{/privacy}","received_events_url":"https://api.github.com/users/seemethere/received_events","type":"User","site_admin":false},"committer":{"login":"facebook-github-bot","id":6422482,"node_id":"MDQ6VXNlcjY0MjI0ODI=","avatar_url":"https://avatars.githubusercontent.com/u/6422482?v=4","gravatar_id":"","url":"https://api.github.com/users/facebook-github-bot","html_url":"https://github.com/facebook-github-bot","followers_url":"https://api.github.com/users/facebook-github-bot/followers","following_url":"https://api.github.com/users/facebook-github-bot/following{/other_user}","gists_url":"https://api.github.com/users/facebook-github-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/facebook-github-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/facebook-github-bot/subscriptions","organizations_url":"https://api.github.com/users/facebook-github-bot/orgs","repos_url":"https://api.github.com/users/facebook-github-bot/repos","events_url":"https://api.github.com/users/facebook-github-bot/events{/privacy}","received_events_url":"https://api.github.com/users/facebook-github-bot/received_events","type":"User","site_admin":false},"parents":[{"sha":"8fd3eaed257884361828217f3aeaabc0296ae906","url":"https://api.github.com/repos/zhaojuanmao/pytorch/commits/8fd3eaed257884361828217f3aeaabc0296ae906","html_url":"https://github.com/zhaojuanmao/pytorch/commit/8fd3eaed257884361828217f3aeaabc0296ae906"}]}]